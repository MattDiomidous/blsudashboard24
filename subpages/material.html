<!DOCTYPE html>
<html>
<head>
  <!-- Compiled and minified Materialize CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  
  <!-- Materialize Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <link rel="stylesheet" href="index.css">
  
  <style>
    .document-card {
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      background-color: #fff8e1;
    }
    .document-header {
      font-size: 24px;
      color: #5d4037;
      margin-bottom: 20px;
    }
    .document-list {
      border: 1px solid #e0e0e0;
      border-radius: 10px;
    }
    /* Additional styles for file upload form */
    .file-field input[type="text"] {
      border-bottom: 1px solid #fff;
    }
    #nav-mobile li a:hover {
        color: grey;
    }

  </style>
  
</head>
<body>

<main>
    <nav class="black">
      <div class="nav-wrapper">
        <a href="#" class="brand-logo">BCA BLSU</a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
            <!-- ... all other navigation links from index.html ... -->
            <li><a class="dropdown-trigger" href="#!" data-target="dropdown1"> <a href="/">Home</a>   </a></li>
            <li><a class="dropdown-trigger" href="#!" data-target="dropdown2"> <a href="tutoring.html"> Tutoring </a>  </a> </li>     
            <li><a class="dropdown-trigger" href="#!" data-target="dropdown3">  <a href="hhm.html">  Lesson Plans </a></li>
            <li><a class="dropdown-trigger" href="#!" data-target="dropdown5"> <a href="blog.html">Announcements</a></li>
            <li id="manageAccount"><a href="account.html">Manage Account</a></li>
            <li id="adminLink" style="display: none;"><a href="admin.html">Administrator</a></li>   
        </ul>
    </div>
    </nav>
</main>

<!-- Database Header -->
<div class="section">
  <div class="container">
    <h4 class="document-header center-align">Database of Club Material</h4>
    <div class="card document-card">
      <div class="card-content">
        <span class="card-title">Documents can be posted and seen here</span>
        <!-- File Upload Form -->
        <form id="uploadForm" enctype="multipart/form-data">
            <div class="file-field input-field">
                <div class="btn">
                    <span>File</span>
                    <input type="file" name="file" required>  <!-- <input type="file" id="myfile" name="myfile" /> -->
                </div>
                <div class="file-path-wrapper">
                    <input class="file-path validate" type="text" placeholder="Upload a document">
                </div>
            </div>
            <button class="btn waves-effect waves-light" type="submit">Upload</button>
        </form>
        <div id="uploadStatus"></div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
      fetch('/api/materials,,,,,,')
          .then(response => response.json())
          .then(materials => {
              const list = document.querySelector('.document-list');
              materials.forEach(material => {
                  const item = document.createElement('li');
                  item.className = 'collection-item avatar';
                  item.innerHTML = `
                      <i class="material-icons circle">insert_drive_file</i>
                      <span class="title">${material.originalName}</span>
                      <p>Last Modified: ${material.uploadDate}</p>
                      <a href="${material.filePath}" target="_blank" class="secondary-content"><i class="material-icons">file_download</i></a>
                  `;
                  list.appendChild(item);
              });
          })
          .catch(error => console.error('Error:', error));
  });
  </script>
  


<!-- Document List Section -->
<div class="section">
  <div class="container">
    <ul class="collection with-header document-list">
      <!-- Dynamically inserted document entries will go here -->
    </ul>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

<script>
  $(document).ready(function() {
      // Check account type
      function checkAccountType() {
          $.get('/accountType', function(data) {
              if (data.account_type === 'Admin') {
                  $('#adminLink').show();
              }
          });
      }

      checkAccountType();  
  });
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var form = document.getElementById('uploadForm');
    form.onsubmit = function(e) {
        e.preventDefault();
        var formData = new FormData(form);
        console.log(formData); 
        fetch('/upload', {
            method: 'POST',
            body: formData,
        })
        


        .then(response => response.text())
        .then(data => {
            document.getElementById('uploadStatus').innerText = 'Upload successful';
            // Optionally, refresh the document list
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('uploadStatus').innerText = 'Upload failed';
        });
        console.log("data?" +  formData)
    };
});




document.addEventListener('DOMContentLoaded', function() {
    window.deleteFile = function(filePath) {
      if (!confirm('Are you sure you want to delete this file?')) return;
      
      fetch('/delete-file', {
          method: 'DELETE',
          headers: {
              'Content-Type': 'application/json',
          },
          body: JSON.stringify({filename: filePath}),

        }) .then(response => response.json())
      
      .then(data => {
          if (data.success) {
              M.toast({html: 'File deleted successfully'});
              // Refresh the document list to reflect the deletion
              fetchDocuments();
          } else {
              M.toast({html: 'Failed to delete the file'});
          }
      })
      .catch((error) => {
          console.error('Error:', error);
          M.toast({html: 'Error deleting file'});
      });
  }

  function fetchDocuments() {
      fetch('/api/materials')
      .then(response => response.json())
      .then(materials => {
          const list = document.querySelector('.document-list');
          list.innerHTML = ''; // Clear the list before appending
          materials.forEach(material => {
              const item = document.createElement('li');
              item.className = 'collection-item avatar';
              item.innerHTML = `
                  <i class="material-icons circle">insert_drive_file</i>
                  <span class="title">${material.originalName}</span>
                  <p>Last Modified: ${material.uploadDate}</p>
                  <a href="${material.filePath}" target="_blank" class="secondary-content">
                      <i class="material-icons">file_download</i>
                  </a>
                  <button onclick="deleteFile('${material.filePath}')" class="secondary-content btn-small red">  
                      <i class="material-icons">delete</i>
                  </button>
              `;
              list.appendChild(item);
          });
      })
      .catch(error => console.error('Error:', error));
  }
  // Initially fetch documents when the page loads
  fetchDocuments();
});


// function isValidFileType(filePath) {
//         const allowedExtensions = ['.pdf', '.png', '.jpeg', '.jpg']; 
//         const fileExtension = filePath.slice((filePath.lastIndexOf(".") - 1 >>> 0) + 2);
//         return allowedExtensions.includes('.' + fileExtension.toLowerCase());
// }









</script>
</body>
</html>
